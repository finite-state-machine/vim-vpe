Starting with version 0.8, VPE is a standard Python package, which should make
it easier to install and upgrade in the future. If you are a user of a pre 0.8
version, then first remove that version, see :ref:`remove_pre_08`.

.. rubric:: Basic installation

VPE can be installed with ``pip`` as follows. A user installation is recommended:

.. code-block:: bash

    python -m pip install --user git+https://github.com/paul-ollis/vim-vpe.git

On some systems you may see a message that starts::

    error: externally-managed-environment

    × This environment is externally managed
    ╰─> To install Python packages system-wide, try apt install
    ...

The typical advice found on the internet suggests that you use a virtual
environment, but that is unlikely to be a practical solution for Vim plugin
code. So in this case you will need to add the option
``--break-system-packages``. This option is deliberately named to be
frightening, but in this case it is safe to use because installing VPE will not
install other Python packages.

.. code-block:: bash

    python -m pip install --break-system-packages --user git+https://github.com/paul-ollis/vim-vpe.git

.. sidebar:: Non-pip users.

    Users of other Python management systems should find it fairly easy to
    adapt the pip instructions.

After the installation completes, you can check the basic installation by
trying to import `vpe` within a new Vim session and checking the version.

.. code-block:: vim

    py3 import vpe
    py3 print(vpe.version)


.. rubric:: Vim init code installation

.. sidebar:: 000-vpe.vim

    The reason for using the name 000-vpe.vim is to make sure that VPE is
    fully initialised *very* early on. This means that other Vim plugins can
    make use of VPE if desired.

The basic installation provides the ``vpe`` package, but to be fully functional
you really need additional Vim initialisation code, in the form of a small Vim
plugin. This typically resides in::

    $HOME/.vim/plugin/000-vpe.vim

VPE can install this plugin for you. From within Vim run:

.. code-block:: vim

    py3 import vpe.install
    py3 vpe.install.run()

This will also install a Vim help file for VPE, which provides limited
more documentation than the HTML version.

.. rubric:: If your Vim uses a different Python version

It may be that your Vim installation uses a different version of Python to the
default for your operating system, in which case the basic installation may
appear to work, but the `vpe` module will not be importable within Vim.

To fix this run the following within Vim to find the correct Python executable
and version for your Vim installation.

.. code-block:: vim

    py3 import sys
    py3 print(sys.executable)
    py3 print(sys.version)

Then run the above pip command with the correct Python version. For example, if
the above commands printed something like::

    /usr/local/bin/python3
    3.11.3 (tags/v3.11.3:f3909b8bc8, Apr 20 2023, 18:55:17) [GCC 11.3.0]

Then you would run:

.. code-block:: bash

    /usr/local/bin/python3.11 -m pip install --user git+https://github.com/paul-ollis/vim-vpe.git


.. rubric:: Controlling 000-vpe.vim

The 000-vpe.vim script runs some code that injects the `vpe` and `vim<vpe.vim>`
objects into Vim's Python namespace and the Python interpreter's builtin
namespace. This matches how VPE worked before version 0.8. However this
is rather invasive and quite possibly not what you really want.

This behaviour can be controlled using configuration values stored in a global
``vpe_config`` dictionary. To do this you should create the configuration in
your $HOME/.vimrc or $HOME/.vim/vimrc file. Edit your vimrc file, place the
cursor at a suitable location and run the command:

.. code-block:: vim

    :Vpe insert_config

The comments inserted with the code should provide all necessary
explanation.


.. _remove_pre_08:

.. rubric:: Removing pre 0.8 VPE

This section is only relevant if you have a pre 0.8 version of VPE installed.

Your pre-0.8 VPE is probably installed in::

    $ $HOME/.vim/pack/vim-vpe

But you may have chosen to a slightly different location.

Remove the ``vim-vpe`` directory to uninstall.

You may also want to review your $HOME/.vim/vimrc and similar files in case you
have initialisation that makes assumptions about your VPE installation.
